{"ast":null,"code":"import _toConsumableArray from\"/home/thaddydore/Desktop/reddish-clone/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _regeneratorRuntime from\"/home/thaddydore/Desktop/reddish-clone/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/thaddydore/Desktop/reddish-clone/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/home/thaddydore/Desktop/reddish-clone/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useState}from'react';import{useParams,Link as RouterLink}from'react-router-dom';import{useSelector,useDispatch}from'react-redux';import{fetchPostComments,toggleUpvote,toggleDownvote}from'../reducers/postCommentsReducer';import{notify}from'../reducers/notificationReducer';import CommentInput from'./CommentInput';import{UpvoteButton,DownvoteButton}from'./VoteButtons';import EditDeleteMenu from'./EditDeleteMenu';import CommentsDisplay from'./CommentsDisplay';import SortCommentsMenu from'./SortCommentsMenu';import ErrorPage from'./ErrorPage';import LoadingSpinner from'./LoadingSpinner';import TimeAgo from'timeago-react';import{trimLink,prettifyLink,fixUrl}from'../utils/formatUrl';import ReactHtmlParser from'react-html-parser';import getErrorMsg from'../utils/getErrorMsg';import{Container,Paper,useMediaQuery,Typography,Link,MenuItem,ListItemIcon,Divider}from'@material-ui/core';import{usePostCommentsStyles}from'../styles/muiStyles';import{useTheme}from'@material-ui/core/styles';import OpenInNewIcon from'@material-ui/icons/OpenInNew';import CommentIcon from'@material-ui/icons/Comment';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var PostCommentsPage=function PostCommentsPage(){var _useParams=useParams(),postId=_useParams.id;var post=useSelector(function(state){return state.postComments;});var _useSelector=useSelector(function(state){return state;}),user=_useSelector.user,darkMode=_useSelector.darkMode;var _useState=useState(true),_useState2=_slicedToArray(_useState,2),pageLoading=_useState2[0],setPageLoading=_useState2[1];var _useState3=useState(null),_useState4=_slicedToArray(_useState3,2),pageError=_useState4[0],setPageError=_useState4[1];var dispatch=useDispatch();useEffect(function(){var getComments=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return dispatch(fetchPostComments(postId));case 3:setPageLoading(false);_context.next=9;break;case 6:_context.prev=6;_context.t0=_context[\"catch\"](0);setPageError(getErrorMsg(_context.t0));case 9:case\"end\":return _context.stop();}}},_callee,null,[[0,6]]);}));return function getComments(){return _ref.apply(this,arguments);};}();getComments();// eslint-disable-next-line react-hooks/exhaustive-deps\n},[postId]);var classes=usePostCommentsStyles();var theme=useTheme();var isMobile=useMediaQuery(theme.breakpoints.down('xs'));if(pageError){return/*#__PURE__*/_jsx(Container,{disableGutters:true,children:/*#__PURE__*/_jsx(Paper,{variant:\"outlined\",className:classes.mainPaper,children:/*#__PURE__*/_jsx(ErrorPage,{errorMsg:pageError})})});}if(!post||pageLoading){return/*#__PURE__*/_jsx(Container,{disableGutters:true,children:/*#__PURE__*/_jsx(Paper,{variant:\"outlined\",className:classes.mainPaper,children:/*#__PURE__*/_jsx(LoadingSpinner,{text:'Fetching post comments...'})})});}var id=post.id,title=post.title,postType=post.postType,textSubmission=post.textSubmission,linkSubmission=post.linkSubmission,imageSubmission=post.imageSubmission,subreddit=post.subreddit,author=post.author,upvotedBy=post.upvotedBy,downvotedBy=post.downvotedBy,pointsCount=post.pointsCount,comments=post.comments,commentCount=post.commentCount,createdAt=post.createdAt,updatedAt=post.updatedAt;var isUpvoted=user&&upvotedBy.includes(user.id);var isDownvoted=user&&downvotedBy.includes(user.id);var handleUpvoteToggle=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var updatedUpvotedBy,_updatedUpvotedBy,updatedDownvotedBy;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:try{if(isUpvoted){updatedUpvotedBy=upvotedBy.filter(function(u){return u!==user.id;});dispatch(toggleUpvote(id,updatedUpvotedBy,downvotedBy));}else{_updatedUpvotedBy=[].concat(_toConsumableArray(upvotedBy),[user.id]);updatedDownvotedBy=downvotedBy.filter(function(d){return d!==user.id;});dispatch(toggleUpvote(id,_updatedUpvotedBy,updatedDownvotedBy));}}catch(err){dispatch(notify(getErrorMsg(err),'error'));}case 1:case\"end\":return _context2.stop();}}},_callee2);}));return function handleUpvoteToggle(){return _ref2.apply(this,arguments);};}();var handleDownvoteToggle=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){var updatedDownvotedBy,_updatedDownvotedBy,updatedUpvotedBy;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:try{if(isDownvoted){updatedDownvotedBy=downvotedBy.filter(function(d){return d!==user.id;});dispatch(toggleDownvote(id,updatedDownvotedBy,upvotedBy));}else{_updatedDownvotedBy=[].concat(_toConsumableArray(downvotedBy),[user.id]);updatedUpvotedBy=upvotedBy.filter(function(u){return u!==user.id;});dispatch(toggleDownvote(id,_updatedDownvotedBy,updatedUpvotedBy));}}catch(err){dispatch(notify(getErrorMsg(err),'error'));}case 1:case\"end\":return _context3.stop();}}},_callee3);}));return function handleDownvoteToggle(){return _ref3.apply(this,arguments);};}();var formattedLink=postType==='Link'&&trimLink(prettifyLink(linkSubmission),70);return/*#__PURE__*/_jsx(Container,{disableGutters:true,children:/*#__PURE__*/_jsxs(Paper,{variant:\"outlined\",className:classes.mainPaper,children:[/*#__PURE__*/_jsxs(\"div\",{className:classes.topPortion,children:[/*#__PURE__*/_jsxs(\"div\",{className:classes.votesWrapper,children:[/*#__PURE__*/_jsx(UpvoteButton,{user:user,body:post,handleUpvote:handleUpvoteToggle,size:isMobile?'small':'medium'}),/*#__PURE__*/_jsx(Typography,{variant:\"body1\",style:{color:isUpvoted?'#FF8b60':isDownvoted?'#9494FF':darkMode?'#e4e4e4':'#333',fontWeight:600},children:pointsCount}),/*#__PURE__*/_jsx(DownvoteButton,{user:user,body:post,handleDownvote:handleDownvoteToggle,size:isMobile?'small':'medium'})]}),/*#__PURE__*/_jsxs(\"div\",{className:classes.postDetails,children:[/*#__PURE__*/_jsxs(Typography,{variant:\"subtitle2\",children:[/*#__PURE__*/_jsx(Link,{component:RouterLink,to:\"/r/\".concat(subreddit.subredditName),children:\"r/\".concat(subreddit.subredditName,\" \")}),/*#__PURE__*/_jsxs(Typography,{variant:\"caption\",className:classes.userAndDate,children:[\"\\u2022 Posted by\",/*#__PURE__*/_jsx(Link,{component:RouterLink,to:\"/u/\".concat(author.username),children:\" u/\".concat(author.username,\" \")}),\"\\u2022 \",/*#__PURE__*/_jsx(TimeAgo,{datetime:new Date(createdAt)}),createdAt!==updatedAt&&/*#__PURE__*/_jsxs(\"em\",{children:[' â€¢ edited',\" \",/*#__PURE__*/_jsx(TimeAgo,{datetime:new Date(updatedAt)})]})]})]}),/*#__PURE__*/_jsx(Typography,{variant:\"h5\",className:classes.title,children:title}),postType==='Text'?/*#__PURE__*/_jsx(\"div\",{children:ReactHtmlParser(textSubmission)}):postType==='Image'?/*#__PURE__*/_jsx(\"a\",{href:imageSubmission.imageLink,alt:title,target:\"_blank\",rel:\"noopener noreferrer\",className:classes.imagePost,children:/*#__PURE__*/_jsx(\"img\",{alt:title,src:imageSubmission.imageLink,className:classes.image})}):/*#__PURE__*/_jsxs(Link,{href:fixUrl(linkSubmission),children:[formattedLink,\" \",/*#__PURE__*/_jsx(OpenInNewIcon,{fontSize:\"inherit\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:classes.bottomBar,children:[/*#__PURE__*/_jsx(MenuItem,{className:classes.bottomButton,children:/*#__PURE__*/_jsxs(ListItemIcon,{children:[/*#__PURE__*/_jsx(CommentIcon,{className:classes.commentIcon}),/*#__PURE__*/_jsx(Typography,{variant:\"subtitle2\",children:commentCount})]})}),user&&user.id===author.id&&/*#__PURE__*/_jsx(EditDeleteMenu,{id:id,isMobile:isMobile,title:title,postType:postType,subreddit:subreddit,buttonType:\"buttonGroup\",textSubmission:textSubmission,linkSubmission:linkSubmission})]}),/*#__PURE__*/_jsx(CommentInput,{user:user,postId:id,isMobile:isMobile}),/*#__PURE__*/_jsx(SortCommentsMenu,{})]})]}),/*#__PURE__*/_jsx(Divider,{className:classes.divider}),/*#__PURE__*/_jsx(CommentsDisplay,{comments:comments,postId:id,isMobile:isMobile})]})});};export default PostCommentsPage;","map":{"version":3,"sources":["/home/thaddydore/Desktop/reddish-clone/client/src/components/PostCommentsPage.js"],"names":["React","useEffect","useState","useParams","Link","RouterLink","useSelector","useDispatch","fetchPostComments","toggleUpvote","toggleDownvote","notify","CommentInput","UpvoteButton","DownvoteButton","EditDeleteMenu","CommentsDisplay","SortCommentsMenu","ErrorPage","LoadingSpinner","TimeAgo","trimLink","prettifyLink","fixUrl","ReactHtmlParser","getErrorMsg","Container","Paper","useMediaQuery","Typography","MenuItem","ListItemIcon","Divider","usePostCommentsStyles","useTheme","OpenInNewIcon","CommentIcon","PostCommentsPage","postId","id","post","state","postComments","user","darkMode","pageLoading","setPageLoading","pageError","setPageError","dispatch","getComments","classes","theme","isMobile","breakpoints","down","mainPaper","title","postType","textSubmission","linkSubmission","imageSubmission","subreddit","author","upvotedBy","downvotedBy","pointsCount","comments","commentCount","createdAt","updatedAt","isUpvoted","includes","isDownvoted","handleUpvoteToggle","updatedUpvotedBy","filter","u","updatedDownvotedBy","d","err","handleDownvoteToggle","formattedLink","topPortion","votesWrapper","color","fontWeight","postDetails","subredditName","userAndDate","username","Date","imageLink","imagePost","image","bottomBar","bottomButton","commentIcon","divider"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from 'react';\nimport { useParams, Link as RouterLink } from 'react-router-dom';\nimport { useSelector, useDispatch } from 'react-redux';\nimport {\n  fetchPostComments,\n  toggleUpvote,\n  toggleDownvote,\n} from '../reducers/postCommentsReducer';\nimport { notify } from '../reducers/notificationReducer';\nimport CommentInput from './CommentInput';\nimport { UpvoteButton, DownvoteButton } from './VoteButtons';\nimport EditDeleteMenu from './EditDeleteMenu';\nimport CommentsDisplay from './CommentsDisplay';\nimport SortCommentsMenu from './SortCommentsMenu';\nimport ErrorPage from './ErrorPage';\nimport LoadingSpinner from './LoadingSpinner';\nimport TimeAgo from 'timeago-react';\nimport { trimLink, prettifyLink, fixUrl } from '../utils/formatUrl';\nimport ReactHtmlParser from 'react-html-parser';\nimport getErrorMsg from '../utils/getErrorMsg';\n\nimport {\n  Container,\n  Paper,\n  useMediaQuery,\n  Typography,\n  Link,\n  MenuItem,\n  ListItemIcon,\n  Divider,\n} from '@material-ui/core';\nimport { usePostCommentsStyles } from '../styles/muiStyles';\nimport { useTheme } from '@material-ui/core/styles';\nimport OpenInNewIcon from '@material-ui/icons/OpenInNew';\nimport CommentIcon from '@material-ui/icons/Comment';\n\nconst PostCommentsPage = () => {\n  const { id: postId } = useParams();\n  const post = useSelector((state) => state.postComments);\n  const { user, darkMode } = useSelector((state) => state);\n  const [pageLoading, setPageLoading] = useState(true);\n  const [pageError, setPageError] = useState(null);\n  const dispatch = useDispatch();\n\n  useEffect(() => {\n    const getComments = async () => {\n      try {\n        await dispatch(fetchPostComments(postId));\n        setPageLoading(false);\n      } catch (err) {\n        setPageError(getErrorMsg(err));\n      }\n    };\n    getComments();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [postId]);\n\n  const classes = usePostCommentsStyles();\n  const theme = useTheme();\n  const isMobile = useMediaQuery(theme.breakpoints.down('xs'));\n\n  if (pageError) {\n    return (\n      <Container disableGutters>\n        <Paper variant=\"outlined\" className={classes.mainPaper}>\n          <ErrorPage errorMsg={pageError} />\n        </Paper>\n      </Container>\n    );\n  }\n\n  if (!post || pageLoading) {\n    return (\n      <Container disableGutters>\n        <Paper variant=\"outlined\" className={classes.mainPaper}>\n          <LoadingSpinner text={'Fetching post comments...'} />\n        </Paper>\n      </Container>\n    );\n  }\n\n  const {\n    id,\n    title,\n    postType,\n    textSubmission,\n    linkSubmission,\n    imageSubmission,\n    subreddit,\n    author,\n    upvotedBy,\n    downvotedBy,\n    pointsCount,\n    comments,\n    commentCount,\n    createdAt,\n    updatedAt,\n  } = post;\n\n  const isUpvoted = user && upvotedBy.includes(user.id);\n  const isDownvoted = user && downvotedBy.includes(user.id);\n\n  const handleUpvoteToggle = async () => {\n    try {\n      if (isUpvoted) {\n        const updatedUpvotedBy = upvotedBy.filter((u) => u !== user.id);\n        dispatch(toggleUpvote(id, updatedUpvotedBy, downvotedBy));\n      } else {\n        const updatedUpvotedBy = [...upvotedBy, user.id];\n        const updatedDownvotedBy = downvotedBy.filter((d) => d !== user.id);\n        dispatch(toggleUpvote(id, updatedUpvotedBy, updatedDownvotedBy));\n      }\n    } catch (err) {\n      dispatch(notify(getErrorMsg(err), 'error'));\n    }\n  };\n\n  const handleDownvoteToggle = async () => {\n    try {\n      if (isDownvoted) {\n        const updatedDownvotedBy = downvotedBy.filter((d) => d !== user.id);\n        dispatch(toggleDownvote(id, updatedDownvotedBy, upvotedBy));\n      } else {\n        const updatedDownvotedBy = [...downvotedBy, user.id];\n        const updatedUpvotedBy = upvotedBy.filter((u) => u !== user.id);\n        dispatch(toggleDownvote(id, updatedDownvotedBy, updatedUpvotedBy));\n      }\n    } catch (err) {\n      dispatch(notify(getErrorMsg(err), 'error'));\n    }\n  };\n\n  const formattedLink =\n    postType === 'Link' && trimLink(prettifyLink(linkSubmission), 70);\n\n  return (\n    <Container disableGutters>\n      <Paper variant=\"outlined\" className={classes.mainPaper}>\n        <div className={classes.topPortion}>\n          <div className={classes.votesWrapper}>\n            <UpvoteButton\n              user={user}\n              body={post}\n              handleUpvote={handleUpvoteToggle}\n              size={isMobile ? 'small' : 'medium'}\n            />\n            <Typography\n              variant=\"body1\"\n              style={{\n                color: isUpvoted\n                  ? '#FF8b60'\n                  : isDownvoted\n                  ? '#9494FF'\n                  : darkMode\n                  ? '#e4e4e4'\n                  : '#333',\n                fontWeight: 600,\n              }}\n            >\n              {pointsCount}\n            </Typography>\n            <DownvoteButton\n              user={user}\n              body={post}\n              handleDownvote={handleDownvoteToggle}\n              size={isMobile ? 'small' : 'medium'}\n            />\n          </div>\n          <div className={classes.postDetails}>\n            <Typography variant=\"subtitle2\">\n              <Link component={RouterLink} to={`/r/${subreddit.subredditName}`}>\n                {`r/${subreddit.subredditName} `}\n              </Link>\n              <Typography variant=\"caption\" className={classes.userAndDate}>\n                â€¢ Posted by\n                <Link component={RouterLink} to={`/u/${author.username}`}>\n                  {` u/${author.username} `}\n                </Link>\n                â€¢ <TimeAgo datetime={new Date(createdAt)} />\n                {createdAt !== updatedAt && (\n                  <em>\n                    {' â€¢ edited'} <TimeAgo datetime={new Date(updatedAt)} />\n                  </em>\n                )}\n              </Typography>\n            </Typography>\n            <Typography variant=\"h5\" className={classes.title}>\n              {title}\n            </Typography>\n            {postType === 'Text' ? (\n              <div>{ReactHtmlParser(textSubmission)}</div>\n            ) : postType === 'Image' ? (\n              <a\n                href={imageSubmission.imageLink}\n                alt={title}\n                target=\"_blank\"\n                rel=\"noopener noreferrer\"\n                className={classes.imagePost}\n              >\n                <img\n                  alt={title}\n                  src={imageSubmission.imageLink}\n                  className={classes.image}\n                />\n              </a>\n            ) : (\n              <Link href={fixUrl(linkSubmission)}>\n                {formattedLink} <OpenInNewIcon fontSize=\"inherit\" />\n              </Link>\n            )}\n            <div className={classes.bottomBar}>\n              <MenuItem className={classes.bottomButton}>\n                <ListItemIcon>\n                  <CommentIcon className={classes.commentIcon} />\n                  <Typography variant=\"subtitle2\">{commentCount}</Typography>\n                </ListItemIcon>\n              </MenuItem>\n              {user && user.id === author.id && (\n                <EditDeleteMenu\n                  id={id}\n                  isMobile={isMobile}\n                  title={title}\n                  postType={postType}\n                  subreddit={subreddit}\n                  buttonType=\"buttonGroup\"\n                  textSubmission={textSubmission}\n                  linkSubmission={linkSubmission}\n                />\n              )}\n            </div>\n            <CommentInput user={user} postId={id} isMobile={isMobile} />\n            <SortCommentsMenu />\n          </div>\n        </div>\n        <Divider className={classes.divider} />\n        <CommentsDisplay comments={comments} postId={id} isMobile={isMobile} />\n      </Paper>\n    </Container>\n  );\n};\n\nexport default PostCommentsPage;\n"]},"metadata":{},"sourceType":"module"}