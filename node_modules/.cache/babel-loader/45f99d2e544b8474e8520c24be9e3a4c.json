{"ast":null,"code":"import _toConsumableArray from\"/home/thaddydore/Desktop/reddish-clone/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _regeneratorRuntime from\"/home/thaddydore/Desktop/reddish-clone/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/thaddydore/Desktop/reddish-clone/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/home/thaddydore/Desktop/reddish-clone/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect}from'react';import{useParams,Link as RouterLink}from'react-router-dom';import{useDispatch,useSelector}from'react-redux';import{fetchSub,toggleUpvote,toggleDownvote,toggleSubscribe,editDescription,loadSubPosts}from'../reducers/subPageReducer';import{notify}from'../reducers/notificationReducer';import SortTabBar from'./SortTabBar';import PostCard from'./PostCard';import LoadMoreButton from'./LoadMoreButton';import PostFormModal from'./PostFormModal';import ErrorPage from'./ErrorPage';import LoadingSpinner from'./LoadingSpinner';import getErrorMsg from'../utils/getErrorMsg';import{Container,Paper,Typography,Button,Link,TextField}from'@material-ui/core';import{useSubPageStyles}from'../styles/muiStyles';import CakeIcon from'@material-ui/icons/Cake';import PersonIcon from'@material-ui/icons/Person';import CheckIcon from'@material-ui/icons/Check';import GroupIcon from'@material-ui/icons/Group';import AddIcon from'@material-ui/icons/Add';import EditIcon from'@material-ui/icons/Edit';import PostAddIcon from'@material-ui/icons/PostAdd';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var SubPage=function SubPage(){var classes=useSubPageStyles();var _useParams=useParams(),sub=_useParams.sub;var dispatch=useDispatch();var _useSelector=useSelector(function(state){return state;}),user=_useSelector.user,subPage=_useSelector.subPage;var _useState=useState(false),_useState2=_slicedToArray(_useState,2),editOpen=_useState2[0],setEditOpen=_useState2[1];var _useState3=useState(''),_useState4=_slicedToArray(_useState3,2),descInput=_useState4[0],setDescInput=_useState4[1];var _useState5=useState('hot'),_useState6=_slicedToArray(_useState5,2),sortBy=_useState6[0],setSortBy=_useState6[1];var _useState7=useState(1),_useState8=_slicedToArray(_useState7,2),page=_useState8[0],setPage=_useState8[1];var _useState9=useState(false),_useState10=_slicedToArray(_useState9,2),loadingMore=_useState10[0],setLoadingMore=_useState10[1];var _useState11=useState(true),_useState12=_slicedToArray(_useState11,2),pageLoading=_useState12[0],setPageLoading=_useState12[1];var _useState13=useState(false),_useState14=_slicedToArray(_useState13,2),postsLoading=_useState14[0],setPostsLoading=_useState14[1];var _useState15=useState(null),_useState16=_slicedToArray(_useState15,2),pageError=_useState16[0],setPageError=_useState16[1];useEffect(function(){var getSub=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return dispatch(fetchSub(sub,'hot'));case 3:setPageLoading(false);_context.next=9;break;case 6:_context.prev=6;_context.t0=_context[\"catch\"](0);setPageError(getErrorMsg(_context.t0));case 9:case\"end\":return _context.stop();}}},_callee,null,[[0,6]]);}));return function getSub(){return _ref.apply(this,arguments);};}();getSub();// eslint-disable-next-line react-hooks/exhaustive-deps\n},[sub]);useEffect(function(){if(subPage){setDescInput(subPage.subDetails.description);}},[subPage]);if(pageError){return/*#__PURE__*/_jsx(Container,{disableGutters:true,children:/*#__PURE__*/_jsx(Paper,{variant:\"outlined\",className:classes.mainPaper,children:/*#__PURE__*/_jsx(ErrorPage,{errorMsg:pageError})})});}if(!subPage||pageLoading){return/*#__PURE__*/_jsx(Container,{disableGutters:true,children:/*#__PURE__*/_jsx(Paper,{variant:\"outlined\",className:classes.mainPaper,children:/*#__PURE__*/_jsx(LoadingSpinner,{text:'Fetching sub data...'})})});}var _subPage$subDetails=subPage.subDetails,subredditName=_subPage$subDetails.subredditName,subscribedBy=_subPage$subDetails.subscribedBy,subscriberCount=_subPage$subDetails.subscriberCount,description=_subPage$subDetails.description,admin=_subPage$subDetails.admin,createdAt=_subPage$subDetails.createdAt,id=_subPage$subDetails.id;var isSubscribed=user&&subscribedBy.includes(user.id);var handleSubJoin=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var updatedSubscribedBy,message;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;updatedSubscribedBy=[];if(isSubscribed){updatedSubscribedBy=subscribedBy.filter(function(s){return s!==user.id;});}else{updatedSubscribedBy=[].concat(_toConsumableArray(subscribedBy),[user.id]);}_context2.next=5;return dispatch(toggleSubscribe(id,updatedSubscribedBy));case 5:message=isSubscribed?\"Unsubscribed from r/\".concat(subredditName):\"Subscribed to r/\".concat(subredditName,\"!\");dispatch(notify(message,'success'));_context2.next=12;break;case 9:_context2.prev=9;_context2.t0=_context2[\"catch\"](0);dispatch(notify(getErrorMsg(_context2.t0),'error'));case 12:case\"end\":return _context2.stop();}}},_callee2,null,[[0,9]]);}));return function handleSubJoin(){return _ref2.apply(this,arguments);};}();var handleEditDescription=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.prev=0;_context3.next=3;return dispatch(editDescription(id,descInput));case 3:setEditOpen(false);dispatch(notify(\"Updated description of your sub: r/\".concat(subredditName),'success'));_context3.next=10;break;case 7:_context3.prev=7;_context3.t0=_context3[\"catch\"](0);dispatch(notify(getErrorMsg(_context3.t0),'error'));case 10:case\"end\":return _context3.stop();}}},_callee3,null,[[0,7]]);}));return function handleEditDescription(){return _ref3.apply(this,arguments);};}();var handleTabChange=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(e,newValue){return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.prev=0;setPostsLoading(true);_context4.next=4;return dispatch(fetchSub(sub,newValue));case 4:setSortBy(newValue);setPostsLoading(false);if(page!==1){setPage(1);}_context4.next=13;break;case 9:_context4.prev=9;_context4.t0=_context4[\"catch\"](0);setPostsLoading(false);dispatch(notify(getErrorMsg(_context4.t0),'error'));case 13:case\"end\":return _context4.stop();}}},_callee4,null,[[0,9]]);}));return function handleTabChange(_x,_x2){return _ref4.apply(this,arguments);};}();var handleLoadPosts=/*#__PURE__*/function(){var _ref5=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(){return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:_context5.prev=0;setLoadingMore(true);_context5.next=4;return dispatch(loadSubPosts(sub,sortBy,page+1));case 4:setPage(function(prevState){return prevState+1;});setLoadingMore(false);_context5.next=11;break;case 8:_context5.prev=8;_context5.t0=_context5[\"catch\"](0);dispatch(notify(getErrorMsg(_context5.t0),'error'));case 11:case\"end\":return _context5.stop();}}},_callee5,null,[[0,8]]);}));return function handleLoadPosts(){return _ref5.apply(this,arguments);};}();return/*#__PURE__*/_jsx(Container,{disableGutters:true,children:/*#__PURE__*/_jsxs(Paper,{variant:\"outlined\",className:classes.mainPaper,children:[/*#__PURE__*/_jsxs(Paper,{variant:\"outlined\",className:classes.subInfoWrapper,children:[/*#__PURE__*/_jsxs(\"div\",{className:classes.firstPanel,children:[/*#__PURE__*/_jsxs(Typography,{variant:\"h6\",color:\"secondary\",children:[\"r/\",subredditName]}),/*#__PURE__*/_jsxs(\"div\",{className:classes.description,children:[!editOpen?/*#__PURE__*/_jsx(Typography,{variant:\"body1\",children:description}):/*#__PURE__*/_jsxs(\"div\",{className:classes.inputDiv,children:[/*#__PURE__*/_jsx(TextField,{multiline:true,required:true,fullWidth:true,rows:2,rowsMax:Infinity,value:descInput,onChange:function onChange(e){return setDescInput(e.target.value);},variant:\"outlined\",size:\"small\"}),/*#__PURE__*/_jsxs(\"div\",{className:classes.submitBtns,children:[/*#__PURE__*/_jsx(Button,{onClick:function onClick(){return setEditOpen(false);},color:\"primary\",variant:\"outlined\",size:\"small\",className:classes.cancelBtn,style:{padding:'0.2em'},children:\"Cancel\"}),/*#__PURE__*/_jsx(Button,{onClick:handleEditDescription,color:\"primary\",variant:\"outlined\",size:\"small\",style:{padding:'0.2em'},children:\"Update\"})]})]}),user&&user.id===admin.id&&!editOpen&&/*#__PURE__*/_jsx(Button,{onClick:function onClick(){return setEditOpen(function(prevState){return!prevState;});},size:\"small\",variant:\"outlined\",color:\"primary\",style:{padding:'0.2em',marginLeft:'0.5em'},startIcon:/*#__PURE__*/_jsx(EditIcon,{}),children:\"Edit\"})]}),/*#__PURE__*/_jsxs(Typography,{variant:\"body2\",className:classes.iconText,color:\"secondary\",children:[/*#__PURE__*/_jsx(CakeIcon,{style:{marginRight:5}}),\" Created\",' '+String(new Date(createdAt)).split(' ').slice(1,4).join(' ')]}),/*#__PURE__*/_jsxs(Typography,{variant:\"body2\",color:\"secondary\",className:classes.iconText,children:[/*#__PURE__*/_jsx(PersonIcon,{style:{marginRight:5}}),\"Admin:\",/*#__PURE__*/_jsxs(Link,{component:RouterLink,to:\"/u/\".concat(admin.username),style:{marginLeft:'0.3em'},children:[\"u/\",admin.username]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:classes.secondPanel,children:[user&&/*#__PURE__*/_jsx(Button,{color:\"primary\",variant:\"contained\",startIcon:isSubscribed?/*#__PURE__*/_jsx(CheckIcon,{}):/*#__PURE__*/_jsx(AddIcon,{}),className:classes.joinBtn,onClick:handleSubJoin,children:isSubscribed?'Subscribed':'Subscribe'}),/*#__PURE__*/_jsxs(Typography,{variant:\"body2\",color:\"primary\",className:classes.iconText,children:[/*#__PURE__*/_jsx(GroupIcon,{style:{marginRight:5}}),subscriberCount,\" subscribers\"]})]})]}),/*#__PURE__*/_jsx(PostFormModal,{fromSubreddit:{subredditName:subredditName,id:id}}),/*#__PURE__*/_jsx(SortTabBar,{sortBy:sortBy,handleTabChange:handleTabChange}),postsLoading?/*#__PURE__*/_jsx(LoadingSpinner,{text:'Fetching subreddit posts...'}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{children:subPage.posts.results.length!==0?subPage.posts.results.map(function(p){return/*#__PURE__*/_jsx(PostCard,{post:p,toggleUpvote:toggleUpvote,toggleDownvote:toggleDownvote},p.id);}):/*#__PURE__*/_jsxs(\"div\",{className:classes.noPosts,children:[/*#__PURE__*/_jsx(PostAddIcon,{color:\"primary\",fontSize:\"large\"}),/*#__PURE__*/_jsx(Typography,{variant:\"h5\",color:\"secondary\",children:\"No Posts Yet\"}),/*#__PURE__*/_jsxs(Typography,{variant:\"h6\",color:\"secondary\",children:[\"Be the first one to post in r/\",subredditName,\"!\"]})]})}),'next'in subPage.posts&&/*#__PURE__*/_jsx(LoadMoreButton,{handleLoadPosts:handleLoadPosts,loading:loadingMore})]})]})});};export default SubPage;","map":{"version":3,"sources":["/home/thaddydore/Desktop/reddish-clone/client/src/components/SubPage.js"],"names":["React","useState","useEffect","useParams","Link","RouterLink","useDispatch","useSelector","fetchSub","toggleUpvote","toggleDownvote","toggleSubscribe","editDescription","loadSubPosts","notify","SortTabBar","PostCard","LoadMoreButton","PostFormModal","ErrorPage","LoadingSpinner","getErrorMsg","Container","Paper","Typography","Button","TextField","useSubPageStyles","CakeIcon","PersonIcon","CheckIcon","GroupIcon","AddIcon","EditIcon","PostAddIcon","SubPage","classes","sub","dispatch","state","user","subPage","editOpen","setEditOpen","descInput","setDescInput","sortBy","setSortBy","page","setPage","loadingMore","setLoadingMore","pageLoading","setPageLoading","postsLoading","setPostsLoading","pageError","setPageError","getSub","subDetails","description","mainPaper","subredditName","subscribedBy","subscriberCount","admin","createdAt","id","isSubscribed","includes","handleSubJoin","updatedSubscribedBy","filter","s","message","handleEditDescription","handleTabChange","e","newValue","handleLoadPosts","prevState","subInfoWrapper","firstPanel","inputDiv","Infinity","target","value","submitBtns","cancelBtn","padding","marginLeft","iconText","marginRight","String","Date","split","slice","join","username","secondPanel","joinBtn","posts","results","length","map","p","noPosts"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { useParams, Link as RouterLink } from 'react-router-dom';\nimport { useDispatch, useSelector } from 'react-redux';\nimport {\n  fetchSub,\n  toggleUpvote,\n  toggleDownvote,\n  toggleSubscribe,\n  editDescription,\n  loadSubPosts,\n} from '../reducers/subPageReducer';\nimport { notify } from '../reducers/notificationReducer';\nimport SortTabBar from './SortTabBar';\nimport PostCard from './PostCard';\nimport LoadMoreButton from './LoadMoreButton';\nimport PostFormModal from './PostFormModal';\nimport ErrorPage from './ErrorPage';\nimport LoadingSpinner from './LoadingSpinner';\nimport getErrorMsg from '../utils/getErrorMsg';\n\nimport {\n  Container,\n  Paper,\n  Typography,\n  Button,\n  Link,\n  TextField,\n} from '@material-ui/core';\nimport { useSubPageStyles } from '../styles/muiStyles';\nimport CakeIcon from '@material-ui/icons/Cake';\nimport PersonIcon from '@material-ui/icons/Person';\nimport CheckIcon from '@material-ui/icons/Check';\nimport GroupIcon from '@material-ui/icons/Group';\nimport AddIcon from '@material-ui/icons/Add';\nimport EditIcon from '@material-ui/icons/Edit';\nimport PostAddIcon from '@material-ui/icons/PostAdd';\n\nconst SubPage = () => {\n  const classes = useSubPageStyles();\n  const { sub } = useParams();\n  const dispatch = useDispatch();\n  const { user, subPage } = useSelector((state) => state);\n  const [editOpen, setEditOpen] = useState(false);\n  const [descInput, setDescInput] = useState('');\n  const [sortBy, setSortBy] = useState('hot');\n  const [page, setPage] = useState(1);\n  const [loadingMore, setLoadingMore] = useState(false);\n  const [pageLoading, setPageLoading] = useState(true);\n  const [postsLoading, setPostsLoading] = useState(false);\n  const [pageError, setPageError] = useState(null);\n\n  useEffect(() => {\n    const getSub = async () => {\n      try {\n        await dispatch(fetchSub(sub, 'hot'));\n        setPageLoading(false);\n      } catch (err) {\n        setPageError(getErrorMsg(err));\n      }\n    };\n    getSub();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [sub]);\n\n  useEffect(() => {\n    if (subPage) {\n      setDescInput(subPage.subDetails.description);\n    }\n  }, [subPage]);\n\n  if (pageError) {\n    return (\n      <Container disableGutters>\n        <Paper variant=\"outlined\" className={classes.mainPaper}>\n          <ErrorPage errorMsg={pageError} />\n        </Paper>\n      </Container>\n    );\n  }\n\n  if (!subPage || pageLoading) {\n    return (\n      <Container disableGutters>\n        <Paper variant=\"outlined\" className={classes.mainPaper}>\n          <LoadingSpinner text={'Fetching sub data...'} />\n        </Paper>\n      </Container>\n    );\n  }\n\n  const {\n    subredditName,\n    subscribedBy,\n    subscriberCount,\n    description,\n    admin,\n    createdAt,\n    id,\n  } = subPage.subDetails;\n\n  const isSubscribed = user && subscribedBy.includes(user.id);\n\n  const handleSubJoin = async () => {\n    try {\n      let updatedSubscribedBy = [];\n\n      if (isSubscribed) {\n        updatedSubscribedBy = subscribedBy.filter((s) => s !== user.id);\n      } else {\n        updatedSubscribedBy = [...subscribedBy, user.id];\n      }\n      await dispatch(toggleSubscribe(id, updatedSubscribedBy));\n\n      let message = isSubscribed\n        ? `Unsubscribed from r/${subredditName}`\n        : `Subscribed to r/${subredditName}!`;\n      dispatch(notify(message, 'success'));\n    } catch (err) {\n      dispatch(notify(getErrorMsg(err), 'error'));\n    }\n  };\n\n  const handleEditDescription = async () => {\n    try {\n      await dispatch(editDescription(id, descInput));\n      setEditOpen(false);\n      dispatch(\n        notify(`Updated description of your sub: r/${subredditName}`, 'success')\n      );\n    } catch (err) {\n      dispatch(notify(getErrorMsg(err), 'error'));\n    }\n  };\n\n  const handleTabChange = async (e, newValue) => {\n    try {\n      setPostsLoading(true);\n      await dispatch(fetchSub(sub, newValue));\n      setSortBy(newValue);\n      setPostsLoading(false);\n\n      if (page !== 1) {\n        setPage(1);\n      }\n    } catch (err) {\n      setPostsLoading(false);\n      dispatch(notify(getErrorMsg(err), 'error'));\n    }\n  };\n\n  const handleLoadPosts = async () => {\n    try {\n      setLoadingMore(true);\n      await dispatch(loadSubPosts(sub, sortBy, page + 1));\n      setPage((prevState) => prevState + 1);\n      setLoadingMore(false);\n    } catch (err) {\n      dispatch(notify(getErrorMsg(err), 'error'));\n    }\n  };\n\n  return (\n    <Container disableGutters>\n      <Paper variant=\"outlined\" className={classes.mainPaper}>\n        <Paper variant=\"outlined\" className={classes.subInfoWrapper}>\n          <div className={classes.firstPanel}>\n            <Typography variant=\"h6\" color=\"secondary\">\n              r/{subredditName}\n            </Typography>\n            <div className={classes.description}>\n              {!editOpen ? (\n                <Typography variant=\"body1\">{description}</Typography>\n              ) : (\n                <div className={classes.inputDiv}>\n                  <TextField\n                    multiline\n                    required\n                    fullWidth\n                    rows={2}\n                    rowsMax={Infinity}\n                    value={descInput}\n                    onChange={(e) => setDescInput(e.target.value)}\n                    variant=\"outlined\"\n                    size=\"small\"\n                  />\n                  <div className={classes.submitBtns}>\n                    <Button\n                      onClick={() => setEditOpen(false)}\n                      color=\"primary\"\n                      variant=\"outlined\"\n                      size=\"small\"\n                      className={classes.cancelBtn}\n                      style={{ padding: '0.2em' }}\n                    >\n                      Cancel\n                    </Button>\n                    <Button\n                      onClick={handleEditDescription}\n                      color=\"primary\"\n                      variant=\"outlined\"\n                      size=\"small\"\n                      style={{ padding: '0.2em' }}\n                    >\n                      Update\n                    </Button>\n                  </div>\n                </div>\n              )}\n              {user && user.id === admin.id && !editOpen && (\n                <Button\n                  onClick={() => setEditOpen((prevState) => !prevState)}\n                  size=\"small\"\n                  variant=\"outlined\"\n                  color=\"primary\"\n                  style={{ padding: '0.2em', marginLeft: '0.5em' }}\n                  startIcon={<EditIcon />}\n                >\n                  Edit\n                </Button>\n              )}\n            </div>\n            <Typography\n              variant=\"body2\"\n              className={classes.iconText}\n              color=\"secondary\"\n            >\n              <CakeIcon style={{ marginRight: 5 }} /> Created\n              {' ' +\n                String(new Date(createdAt)).split(' ').slice(1, 4).join(' ')}\n            </Typography>\n            <Typography\n              variant=\"body2\"\n              color=\"secondary\"\n              className={classes.iconText}\n            >\n              <PersonIcon style={{ marginRight: 5 }} />\n              Admin:\n              <Link\n                component={RouterLink}\n                to={`/u/${admin.username}`}\n                style={{ marginLeft: '0.3em' }}\n              >\n                u/{admin.username}\n              </Link>\n            </Typography>\n          </div>\n          <div className={classes.secondPanel}>\n            {user && (\n              <Button\n                color=\"primary\"\n                variant=\"contained\"\n                startIcon={isSubscribed ? <CheckIcon /> : <AddIcon />}\n                className={classes.joinBtn}\n                onClick={handleSubJoin}\n              >\n                {isSubscribed ? 'Subscribed' : 'Subscribe'}\n              </Button>\n            )}\n            <Typography\n              variant=\"body2\"\n              color=\"primary\"\n              className={classes.iconText}\n            >\n              <GroupIcon style={{ marginRight: 5 }} />\n              {subscriberCount} subscribers\n            </Typography>\n          </div>\n        </Paper>\n        <PostFormModal fromSubreddit={{ subredditName, id }} />\n        <SortTabBar sortBy={sortBy} handleTabChange={handleTabChange} />\n        {postsLoading ? (\n          <LoadingSpinner text={'Fetching subreddit posts...'} />\n        ) : (\n          <>\n            <div>\n              {subPage.posts.results.length !== 0 ? (\n                subPage.posts.results.map((p) => (\n                  <PostCard\n                    key={p.id}\n                    post={p}\n                    toggleUpvote={toggleUpvote}\n                    toggleDownvote={toggleDownvote}\n                  />\n                ))\n              ) : (\n                <div className={classes.noPosts}>\n                  <PostAddIcon color=\"primary\" fontSize=\"large\" />\n                  <Typography variant=\"h5\" color=\"secondary\">\n                    No Posts Yet\n                  </Typography>\n                  <Typography variant=\"h6\" color=\"secondary\">\n                    Be the first one to post in r/{subredditName}!\n                  </Typography>\n                </div>\n              )}\n            </div>\n            {'next' in subPage.posts && (\n              <LoadMoreButton\n                handleLoadPosts={handleLoadPosts}\n                loading={loadingMore}\n              />\n            )}\n          </>\n        )}\n      </Paper>\n    </Container>\n  );\n};\n\nexport default SubPage;\n"]},"metadata":{},"sourceType":"module"}